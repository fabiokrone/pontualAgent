(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{747:(e,r,t)=>{"use strict";t.d(r,{As:()=>l,OJ:()=>n});var o=t(5155),a=t(2115);let s=(0,a.createContext)(void 0);function n(e){let{children:r}=e,[t,n]=(0,a.useState)(null),[l,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("token");e?u(e):d(!1)},[]);let u=async e=>{try{let r,t=await fetch("/api/auth/me",{headers:{Authorization:"Bearer ".concat(e)}});try{r=await t.json()}catch(e){throw console.error("Erro ao processar resposta JSON:",e),Error("Resposta inv\xe1lida do servidor")}t.ok?(n(r),i(e)):(console.error("Falha na autentica\xe7\xe3o:",r),localStorage.removeItem("token"))}catch(e){console.error("Erro ao buscar dados do usu\xe1rio:",e),localStorage.removeItem("token")}finally{d(!1)}};return(0,o.jsx)(s.Provider,{value:{user:t,token:l,login:(e,r)=>{localStorage.setItem("token",e),i(e),n(r),document.cookie="token=".concat(e,"; path=/; max-age=").concat(604800)},logout:()=>{localStorage.removeItem("token"),i(null),n(null),document.cookie="token=; path=/; max-age=0",window.location.href="/login"},isLoading:c},children:r})}function l(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},5695:(e,r,t)=>{"use strict";var o=t(8999);t.o(o,"useParams")&&t.d(r,{useParams:function(){return o.useParams}}),t.o(o,"usePathname")&&t.d(r,{usePathname:function(){return o.usePathname}}),t.o(o,"useRouter")&&t.d(r,{useRouter:function(){return o.useRouter}}),t.o(o,"useSearchParams")&&t.d(r,{useSearchParams:function(){return o.useSearchParams}})},6001:(e,r,t)=>{Promise.resolve().then(t.bind(t,8007))},8007:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var o=t(5155),a=t(2115),s=t(5695),n=t(747),l=t(6874),i=t.n(l);function c(){let{login:e,isLoading:r,user:t}=(0,n.As)(),l=(0,s.useRouter)(),c=async r=>{r.preventDefault();let t=new FormData(r.currentTarget),o=t.get("email"),a=t.get("password");if(!o||!a)return void alert("Por favor, preencha todos os campos");let s="http://localhost:8000/api";if(!s){console.error("Erro Cr\xedtico: A vari\xe1vel de ambiente NEXT_PUBLIC_API_URL n\xe3o est\xe1 definida!"),alert("Erro de configura\xe7\xe3o do sistema. Contate o administrador.");return}let n="".concat(s,"/auth/login");console.log("Enviando requisi\xe7\xe3o de login para: ".concat(n));try{let r,t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o,password:a})});console.log("Status da resposta:",t.status);let s=await t.text();console.log("Texto da resposta:",s);try{if(s)r=JSON.parse(s);else{if(!t.ok)throw Error("Resposta vazia do servidor com erro de status.");r={}}}catch(e){throw console.error("Erro ao processar resposta JSON:",e),Error("Resposta inv\xe1lida do servidor (n\xe3o JSON). Status: ".concat(t.status,". Resposta: ").concat(s))}if(!t.ok){var i;let e="Erro ao fazer login (Status: ".concat(t.status,")");throw(null==r?void 0:r.detail)&&Array.isArray(r.detail)&&(null==(i=r.detail[0])?void 0:i.msg)?e=r.detail[0].msg:(null==r?void 0:r.detail)&&(e=r.detail),Error(e)}if(!r.access_token)throw Error("Token de acesso n\xe3o encontrado na resposta do servidor.");e(r.access_token,r.user||{email:o}),l.push("/dashboard")}catch(e){console.error("Erro completo durante o login:",e),alert(e.message||"Ocorreu um erro inesperado ao fazer login")}};return((0,a.useEffect)(()=>{t&&!r&&l.push("/dashboard")},[t,r,l]),r)?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"}),(0,o.jsx)("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})}):(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:(0,o.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[(0,o.jsxs)("div",{className:"text-center mb-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"PontoAgent"}),(0,o.jsx)("p",{className:"text-gray-600 mt-2",children:"Sistema de Gest\xe3o de Ponto"})]}),(0,o.jsxs)("form",{onSubmit:c,className:"space-y-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:" E-mail "}),(0,o.jsx)("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"email",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Digite seu e-mail"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:" Senha "}),(0,o.jsx)("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"current-password",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Digite sua senha"})]}),(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,o.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700",children:" Lembrar-me "})]}),(0,o.jsx)("div",{className:"text-sm",children:(0,o.jsx)(i(),{href:"/esqueci-minha-senha",className:"text-blue-600 hover:text-blue-500",children:"Esqueceu a senha?"})})]}),(0,o.jsx)("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:" Entrar "})]}),(0,o.jsx)("div",{className:"mt-6 text-center text-sm text-gray-500",children:(0,o.jsx)("p",{children:"\xa9 2025 PontoAgent - Todos os direitos reservados"})})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[874,441,684,358],()=>r(6001)),_N_E=e.O()}]);